<IfModule mod_ssl.c>
<VirtualHost *:443>
    ServerAdmin webmaster@mevacoin.com
    ServerName mevacoin.com
    ServerAlias www.mevacoin.com
    DocumentRoot /var/www/mevacoin

    <Directory /var/www/mevacoin>
        Options Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        # Charset UTF-8 per file HTML/JS/CSS
        AddDefaultCharset UTF-8
    </Directory>

    # Log
    ErrorLog ${APACHE_LOG_DIR}/mevacoin_error.log
    CustomLog ${APACHE_LOG_DIR}/mevacoin_access.log combined

    # Proxy verso il wallet API (solo localhost)
    ProxyPass "/wallet-api" "http://127.0.0.1:17082/"
    ProxyPassReverse "/wallet-api" "http://127.0.0.1:17082/"

    # Inserisce automaticamente la chiave API per tutte le richieste al proxy
    <Proxy "http://127.0.0.1:17082/">
        RequestHeader set X-API-KEY "desy2011"
    </Proxy>

    # Header di sicurezza (permesso CSS e JS inline)
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set Referrer-Policy "no-referrer"
    Header always set Content-Security-Policy "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; font-src 'self';"

    # Certificati SSL Let's Encrypt
    Include /etc/letsencrypt/options-ssl-apache.conf
    SSLCertificateFile /etc/letsencrypt/live/mevacoin.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/mevacoin.com/privkey.pem
</VirtualHost>
</IfModule>
